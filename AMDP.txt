PUBLIC
FINAL
CREATE PUBLIC .



PUBLIC SECTION.
INTERFACES : IF_AMDP_MARKER_HDB.
types : BEGIN OF ty_AMDP,
WERKS type WERKS_D,
LGORT type LGORT_D,
LGOBE type LGOBE,
MATNR type MATNR,
LABST type LABST,
UMLME type UMLME,
INSME type INSME,
MAKTX type MAKTX,
stats type string,
END OF ty_AMDP.



TYPES : it_AMDP type table of ty_AMDP.
METHODS : GET_LGORT IMPORTING VALUE(I_LGORT) TYPE STRING
VALUE(IM_MANDT) TYPE ZT461_T001L-MANDT
VALUE(IM_SPRAS) TYPE ZT461_MAKT-SPRAS
EXPORTING VALUE(IT_RES) TYPE it_AMDP.
PROTECTED SECTION.
PRIVATE SECTION.
ENDCLASS.





CLASS zvsc_amdpclass_sprint IMPLEMENTATION.
METHOD GET_LGORT BY DATABASE PROCEDURE FOR HDB LANGUAGE SQLSCRIPT USING ZT461_T001L ZT461_MARD ZT461_MAKT.
IT_RES = SELECT
T.WERKS,
T.LGORT,
T.LGOBE,
M.MATNR,
M.LABST,
M.UMLME,
M.INSME,
UPPER(K.maktx) AS MAKTX,
CASE
WHEN M.LABST between 1 and 1000 THEN 'LOW'
when M.LABST between 1001 and 2000 then 'MEDIUM'
when M.LABST > 2000 THEN 'HIGH'
ELSE 'NA'
END AS STATS
FROM ZT461_T001L AS T INNER JOIN ZT461_MARD AS M
ON T.LGORT = M.LGORT
INNER JOIN ZT461_MAKT AS K ON M.MATNR = K.MATNR
WHERE
T.MANDT = :IM_MANDT
AND K.SPRAS = :IM_SPRAS;
IT_RES = apply_filter ( :IT_RES, :I_LGORT);



ENDMETHOD.
ENDCLASS.